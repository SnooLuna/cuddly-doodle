---
title: "Eyetrackinganalysis"
author: "Vasilija Dolamic"
date: "2025-11-21"
output: html_document
---

```{r}
dat1 <- readRDS("FinalDat_sub1.rds")
dat2 <- readRDS("FinalDat_s2.rds")
dat3 <- readRDS("FinalDat_s3.rds")
```


```{r}
ppl_plot_avg(data = dat3, xlim = c(-250, 2000), Column = "Pupil",
             Condition1 = NULL, Condition2 = NULL, Cond1Labels = NA, 
             Cond2Labels = NA, ErrorBar = FALSE, ErrorBand=TRUE, PupilPreTheme = TRUE) 
```

```{r}
avg <- with(dat6[dat6$Time >= -250 & dat6$Time <= 2000,], aggregate(list(Pupil=Pupil), list(Time=Time),mean))
plot(avg$Time, avg$Pupil)
hist(dat_all$Time, breaks=30000)
```


```{r}
ggplot(dat_all, aes(x=Time, y=Pupil)) + stat_summary(aes(y=Pupil, group=diff, colour=diff), fun.y= mean, geom="line") + theme_minimal() + facet_wrap(vars(Subject)) + xlim(-100, 8000)
```
```{r}
font_add_google("Schoolbell", family = "Schoolbell")
showtext_auto()
```


```{r}
p <- ggplot(dat_all, aes(x=Time, y=Pupil)) + stat_summary(aes(y=Pupil, group=diff, colour=diff), fun.y= mean, geom="line", linewidth=2) + theme_minimal(base_family = "Schoolbell") + xlim(-100, 8000) + scale_colour_manual(values = c("deeppink", "green")) + labs(title = "Pupil dilation over time per difficulty", colour = "Difficulty") +
  theme(
    text=element_text(size=20),
    panel.background = element_rect(fill='transparent'), #transparent panel bg
    plot.background = element_rect(fill='transparent', color=NA), #transparent plot bg
    panel.grid.minor = element_blank(), #remove minor gridlines
    legend.background = element_rect(fill='transparent'), #transparent legend bg
    legend.box.background = element_blank() #transparent legend panel
  )
    
ggsave('graphs/sorry.png', p, width = 8, height = 5, dpi = 80, bg='transparent')
```

```{r}
p <- ggplot(dat_all, aes(x=Time, y=Pupil)) + stat_summary(aes(y=Pupil, group=diff, colour=diff), fun.y= mean, geom="line", linewidth=2) + theme_minimal(base_family = "Schoolbell") + xlim(-100, 8000) + scale_colour_manual(values = c("deeppink", "green")) + facet_wrap(vars(Subject)) + labs(title = "Pupil dilation over time per difficulty and subject", colour = "Difficulty") +
  theme(
    text=element_text(size=20),
    panel.background = element_rect(fill='transparent'), #transparent panel bg
    plot.background = element_rect(fill='transparent', color=NA), #transparent plot bg
    panel.grid.minor = element_blank(), #remove minor gridlines
    legend.background = element_rect(fill='transparent'), #transparent legend bg
    legend.box.background = element_blank() #transparent legend panel
  )
    
ggsave('graphs/sorrysubs.png', p, width = 10, height = 3, dpi = 80, bg='transparent')
```

```{r}
ggplot(dat_all, aes(x=Time, y=Pupil)) + stat_summary(aes(y=Pupil, group=diff, colour=diff), fun.y= mean, geom="line", linewidth=2) + theme_minimal(base_family = "Schoolbell") + xlim(-100, 8000) + scale_colour_manual(values = c("deeppink", "green")) + facet_wrap(vars(Condition, Subject)) + labs(title = "Pupil dilation over time per difficulty", colour = "Difficulty") +
  theme(
    text=element_text(size=20),
    panel.background = element_rect(fill='transparent'), #transparent panel bg
    plot.background = element_rect(fill='transparent', color=NA), #transparent plot bg
    panel.grid.minor = element_blank(), #remove minor gridlines
    legend.background = element_rect(fill='transparent'), #transparent legend bg
    legend.box.background = element_blank() #transparent legend panel
  )
    
ggsave('graphs/sorry.png', p, width = 8, height = 5, dpi = 80, bg='transparent')
```

```{r}
ggplot(dat_all, aes(x=Time, y=Pupil)) + stat_summary(aes(y=Pupil), fun.y= mean, geom="line") + theme_minimal() 
```


```{r}
easy_trials <- dat6 %>%
  filter(str_detect(SAMPLE_MESSAGE, "diff\\s+easy")) %>%
  pull(TRIAL_INDEX)

diff_trials <- dat6 %>%
  filter(str_detect(SAMPLE_MESSAGE, "diff\\s+difficult")) %>%
  pull(TRIAL_INDEX)

easy_trials
diff_trials

diff_index <-c(1,4,6,7,9,11,13,14,15,16,22,23,24,27,28,31,32,34,35,38,41,43,48,49,50,52,54,58,59,60,65,66,67,69,70,74,75,76,77,80,81,83,86,88,90,92,94,95,99,100,101,105,106,108,109,112,116,117,118,119)

dat_all$diff <- ifelse(
  dat_all$diff %in% c("diff"),
  "difficult",
  "easy")

dat6$diff <- ifelse(
  dat6$TRIAL_INDEX %in% diff_index,
  "difficult",
  "easy")
head(dat6$diff)
tail(dat6$diff)
unique(dat6$diff)
tail(dat6$TRIAL_INDEX)
table(dat6$diff)
```

```{r}
dat6$diff <- as.factor(dat6$diff)
ppl_plot_avg(data = dat6, 
             xlim = c(-250, 2000), 
             Column = "Pupil",
             Condition1 = "diff",   # rlang unquote, or
             # Condition1 = eval(cond1),  # alternative
            , Condition2 = NULL,
             ErrorBar = FALSE, 
             ErrorBand = TRUE, 
             PupilPreTheme = TRUE) +
  scale_color_manual(values = c("easy" = "darkgreen", "diff" = "darkred"))

#figure out how to change colours
```

```{r}


dat_all$Condition <- ifelse(
  dat_all$Subject %in% c("sub1", "sub2"),
  ifelse(dat_all$TRIAL_INDEX %in% c(1:60), "No_Feedback", "Feedback"),
  ifelse(dat_all$TRIAL_INDEX %in% c(1:60), "Feedback", "No_Feedback"))

table(dat_all$Condition, dat_all$Subject)
```


```{r}
dat_feedback <- dat6 %>% filter(TRIAL_INDEX %in% 1:60)
dat_nofeedback <- dat6 %>% filter(TRIAL_INDEX %in% 61:120)
with(dat_feedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
with(dat_nofeedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
#It is true if dynamic = 1 was with online feedback
```

```{r}
dat6_s2 <- dat2
dat6_s3 <- dat3

easy_trials <- dat6_s2 %>%
  filter(str_detect(SAMPLE_MESSAGE, "diff\\s+easy")) %>%
  pull(TRIAL_INDEX)

diff_trials <- dat6_s2 %>%
  filter(str_detect(SAMPLE_MESSAGE, "diff\\s+difficult")) %>%
  pull(TRIAL_INDEX)

easy_trials
diff_trials

easy_index <-c(3,4,5,9,10,13,15,17,18,19,22,23,24,25,28,31,32,33,38,39,42,45,47,49,50,52,53,55,56,59,61,63,65,66,70,71,73, 75,76,77,81,84,87,88,90,91,92,94,97,100,102,103,104,106,108,111,112,116,118,119)
length(easy_index)

dat6_s2$diff <- ifelse(
  dat6_s2$TRIAL_INDEX %in% easy_index,
  "easy",
  "diff")
head(dat6_s2$diff)

```

```{r}
easy_trials3 <- dat6_s3 %>%
  filter(str_detect(SAMPLE_MESSAGE, "diff\\s+easy")) %>%
  pull(TRIAL_INDEX)

diff_trials3 <- dat6_s3 %>%
  filter(str_detect(SAMPLE_MESSAGE, "diff\\s+difficult")) %>%
  pull(TRIAL_INDEX)

easy_trials3
diff_trials3

easy_index3 <-c(1,6,7,8,9,15,16,17,19,20,22,27,28,29,30,31,33,34,35,37,42,45,46,48,49,52,53,55,56,60,63,64,66,67,70,74,76,77,79,80,81,83,84,85,88,91,94,96,98,100,101,103,106,109,110,114,115,116,118,119)
length(easy_index3)

dat6_s3$diff <- ifelse(
  dat6_s3$TRIAL_INDEX %in% easy_index3,
  "easy",
  "diff")
head(dat6_s3$diff)

```

```{r}
dat6_s2$diff <- as.factor(dat6_s2$diff)
ppl_plot_avg(data = dat6_s2, 
             xlim = c(-250, 2000), 
             Column = "Pupil",
             Condition1 = "diff",   # rlang unquote, or
             # Condition1 = eval(cond1),  # alternative
            , Condition2 = NULL,
             ErrorBar = FALSE, 
             ErrorBand = TRUE, 
             PupilPreTheme = TRUE)

```

```{r}
dat6_s3$diff <- as.factor(dat6_s3$diff)
ppl_plot_avg(data = dat6_s3, 
             xlim = c(-250, 2000), 
             Column = "Pupil",
             Condition1 = "diff",   # rlang unquote, or
             # Condition1 = eval(cond1),  # alternative
            , Condition2 = NULL,
             ErrorBar = FALSE, 
             ErrorBand = TRUE, 
             PupilPreTheme = TRUE)
```
```{r}
dats2_nofeedback <- dat6_s2 %>% filter(TRIAL_INDEX %in% 1:60) 
dats2_feedback <- dat6_s2 %>% filter(TRIAL_INDEX %in% 61:120)
with(dats2_feedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
with(dats2_nofeedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
```
```{r}
dats3_feedback <- dat6_s3 %>% filter(TRIAL_INDEX %in% 1:60)
dats3_nofeedback <- dat6_s3 %>% filter(TRIAL_INDEX %in% 61:120)
with(dats3_feedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
with(dats3_nofeedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
```

```{r}
p <- ggplot(dat_all, aes(x=Gaze_X, y=Gaze_Y, colour=TRIAL_INDEX)) + scale_colour_continuous(palette= c("darkblue","blue", "purple", "deeppink", "white")) + geom_point() + facet_wrap(vars(Condition, Subject)) + expand_limits(x = c(0, 1400), y = c(100,1010)) + theme_minimal(base_family = "Schoolbell") + labs(title = "Gaze position per condition and subject", colour = "Trial") +
  theme(
      text=element_text(size=24),
    panel.background = element_rect(fill='transparent'), #transparent panel bg
    plot.background = element_rect(fill='transparent', color=NA), #transparent plot bg
    panel.grid.minor = element_blank(), #remove minor gridlines
    legend.background = element_rect(fill='transparent'), #transparent legend bg
    legend.box.background = element_blank() #transparent legend panel
  )

ggsave('graphs/sorrygays.png', p, width = 10, height = 6, dpi = 100, bg='transparent')
```

```{r}
ggplot(dat_all, aes(x=Gaze_X, y=Gaze_Y, colour=TRIAL_INDEX)) + scale_colour_continuous(palette= c("darkblue","blue", "purple", "deeppink", "white")) + geom_point() + facet_wrap(vars(interaction(Subject, Condition, diff)), ncol=3) + expand_limits(x = c(0, 1400), y = c(100,1010)) + theme_minimal(base_family = "Schoolbell") + labs(title = "Gaze position per condition and subject", colour = "Trial") +
  theme(
    panel.background = element_rect(fill='transparent'), #transparent panel bg
    plot.background = element_rect(fill='transparent', color=NA), #transparent plot bg
    panel.grid.minor = element_blank(), #remove minor gridlines
    legend.background = element_rect(fill='transparent'), #transparent legend bg
    legend.box.background = element_blank() #transparent legend panel
  )
```


# All subjects
```{r}
dat_all <- bind_rows(dat6, dat6_s2, dat6_s3)
head(dat_all)
```
```{r}
dat_all$diff <- as.factor(dat_all$diff)
ppl_plot_avg(data = dat_all, 
             xlim = c(-250, 2000), 
             Column = "Pupil",
             Condition1 = "diff",   # rlang unquote, or
             # Condition1 = eval(cond1),  # alternative
            , Condition2 = NULL,
             ErrorBar = FALSE, 
             ErrorBand = TRUE, 
             PupilPreTheme = TRUE)
```
```{r}
dat_all_feedback <- bind_rows(dat_feedback, dats2_feedback, dats3_feedback)
dat_all_nofeedback <- bind_rows(dat_nofeedback,dats2_nofeedback,dats3_nofeedback)
with(dat_all_feedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
with(dat_all_nofeedback,plot(Gaze_X,Gaze_Y,xlim=c(100,1400),ylim=c(0,1200)))
```

